# Fichier de Workflow GitHub Actions pour le scraping automatique

name: Scraper les pharmacies chaque semaine

on:
  # Permet de lancer ce workflow manuellement depuis l'onglet Actions de GitHub
  workflow_dispatch:
  # Se déclenche chaque lundi à 3h00 du matin (UTC)
  schedule:
    - cron: '0 3 * * 1'

jobs:
  scrape:
    runs-on: ubuntu-latest

    steps:
      # 1. Récupère le code de votre projet
      - name: Checkout du code
        uses: actions/checkout@v4

      # 2. Configure l'environnement Python
      - name: Mise en place de Python 3.10
        uses: actions/setup-python@v5
        with:
          python-version: '3.10'
      
      # 3. Installe les dépendances Python nécessaires pour le scraper
      - name: Installation des dépendances du scraper
        run: |
          python -m pip install --upgrade pip
          pip install -r scraper/requirements.txt
        
      # 4. Exécute le script de scraping
      - name: Lancement du script de scraping
        run: python scraper/scrape_pharmacies.py

      # 5. Commit et Push les modifications si le fichier de données a changé
      #    Cela déclenchera automatiquement un redéploiement sur Vercel
      - name: Commit et Push des données mises à jour
        uses: stefanzweifel/git-auto-commit-action@v5
        with:
          commit_message: 'chore(data): Mise à jour automatique des données des pharmacies'
          file_pattern: src/data/pharmacies.json
          commit_user_name: 'GitHub Actions Bot'
          commit_user_email: 'actions@github.com'
          commit_author: 'GitHub Actions Bot <actions@github.com>'
